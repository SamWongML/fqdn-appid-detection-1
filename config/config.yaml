# FQDN Orphan Detection - Main Configuration
# Environment-specific overrides can be placed in config.{env}.yaml

# Project Metadata
project:
  name: "fqdn-orphan-detection"
  version: "1.0.0"
  description: "Enterprise ML system for FQDN orphan classification"

# Data Source Configuration
data:
  # Primary data source type: "postgres" or "csv"
  primary_source: "csv"

  # PostgreSQL Configuration
  postgres:
    host: ${POSTGRES_HOST:localhost}
    port: ${POSTGRES_PORT:5432}
    database: ${POSTGRES_DB:fqdn_db}
    schema: ${POSTGRES_SCHEMA:da}
    table: "fqdn_prod_inventory_enriched_v2"
    user: ${POSTGRES_USER:postgres}
    password: ${POSTGRES_PASSWORD:}
    pool_size: 10
    connection_timeout: 30

    # Query optimization
    chunk_size: 50000
    use_arrow: true # Use Arrow for fast transfer

  # CSV Configuration
  csv:
    # Path patterns for data files
    labeled_data: "data/raw/labeled_fqdns.csv"
    unlabeled_data: "data/raw/orphan_fqdns.csv"

    # CSV reading options
    separator: ","
    has_header: true
    encoding: "utf-8"
    null_values: ["", "NULL", "null", "None", "NA", "N/A"]
    ignore_errors: false

  # Data filtering
  filters:
    # Status filter (optional)
    include_status: ["Active", "Demised"]
    # Exclude test records
    exclude_patterns:
      - "test.*"
      - ".*localhost.*"
      - ".*127\\.0\\.0\\.1.*"

  # Train/Validation/Test split
  split:
    train_ratio: 0.7
    val_ratio: 0.15
    test_ratio: 0.15
    stratify_column: "appid"
    random_seed: 42

  # Class filtering
  class_config:
    min_samples_per_class: 3 # Minimum samples to include class
    max_classes: null # null = no limit
    handle_rare_classes: "group" # "drop", "group", or "oversample"
    rare_class_threshold: 5

# Target Configuration
target:
  column: "appid"
  orphan_value: 0
  unknown_class_label: -1 # For open-set recognition

# Validation
validation:
  enable_data_validation: true
  required_columns:
    - "fqdn"
    - "record_type"
    - "record_data"
    - "appid"

  # Data quality thresholds
  max_missing_ratio: 0.5
  max_duplicate_ratio: 0.1

  # Schema validation
  schema:
    fqdn:
      type: "string"
      nullable: false
      min_length: 3
    appid:
      type: "integer"
      nullable: false
    record_type:
      type: "string"
      nullable: true
      allowed_values: ["A", "AAAA", "CNAME", "MX", "TXT", "NS", "PTR", "SRV"]

# Logging Configuration
logging:
  level: ${LOG_LEVEL:INFO}
  format: ${LOG_FORMAT:json}

  # File logging
  file:
    enabled: true
    path: "logs/fqdn_detection.log"
    rotation: "10 MB"
    retention: "30 days"

  # Console logging
  console:
    enabled: true
    colorize: true

# Caching
cache:
  enabled: true
  backend: "disk" # "disk", "redis", "memory"
  path: ".cache/"
  ttl: 86400 # 24 hours

# Experiment Tracking (MLflow)
mlflow:
  enabled: true
  tracking_uri: ${MLFLOW_TRACKING_URI:mlruns}
  experiment_name: ${MLFLOW_EXPERIMENT_NAME:fqdn-orphan-detection}

  # Artifacts to log
  log_artifacts:
    - "model"
    - "config"
    - "metrics"
    - "confusion_matrix"
    - "feature_importance"

  # Tags for organization
  tags:
    - "fqdn"
    - "classification"
    - "production"

# Reproducibility
reproducibility:
  seed: 42
  deterministic: true
